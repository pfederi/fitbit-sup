{"version":3,"file":"rollup-plugin-babel.esm.js","sources":["../src/constants.js","../src/preflightCheck.js","../src/helperPlugin.js","../src/utils.js","../src/index.js"],"sourcesContent":["export const INLINE = {};\nexport const RUNTIME = {};\nexport const EXTERNAL = {};\n\n// NOTE: DO NOT REMOVE the null character `\\0` as it may be used by other plugins\n// e.g. https://github.com/rollup/rollup-plugin-node-resolve/blob/313a3e32f432f9eb18cc4c231cc7aac6df317a51/src/index.js#L74\nexport const HELPERS = '\\0rollupPluginBabelHelpers';\n","import { join, dirname } from 'path';\nimport { transform } from '@babel/core';\nimport { INLINE, RUNTIME, EXTERNAL } from './constants.js';\n\nconst MODULE_ERROR =\n\t'Rollup requires that your Babel configuration keeps ES6 module syntax intact. ' +\n\t'Unfortunately it looks like your configuration specifies a module transformer ' +\n\t'to replace ES6 modules with another module format. To continue you have to disable it.' +\n\t'\\n\\n' +\n\t\"Most commonly it's a CommonJS transform added by @babel/preset-env - \" +\n\t'in such case you should disable it by adding `modules: false` option to that preset ' +\n\t'(described in more detail here - https://github.com/rollup/rollup-plugin-babel#modules ).';\n\nconst UNEXPECTED_ERROR =\n\t'An unexpected situation arose. Please raise an issue at ' +\n\t'https://github.com/rollup/rollup-plugin-babel/issues. Thanks!';\n\nfunction fallbackClassTransform() {\n\treturn {\n\t\tvisitor: {\n\t\t\tClassDeclaration(path, state) {\n\t\t\t\tpath.replaceWith(state.file.addHelper('inherits'));\n\t\t\t},\n\t\t},\n\t};\n}\n\nexport default function createPreflightCheck() {\n\tlet preflightCheckResults = {};\n\n\treturn (ctx, options, file) => {\n\t\tif (preflightCheckResults[file] === undefined) {\n\t\t\tlet helpers;\n\n\t\t\toptions = Object.assign({}, options);\n\t\t\tdelete options.only;\n\t\t\tdelete options.ignore;\n\n\t\t\toptions.filename = join(dirname(file), 'x.js');\n\n\t\t\tconst inputCode = 'class Foo extends Bar {};\\nexport default Foo;';\n\t\t\tconst transformed = transform(inputCode, options);\n\n\t\t\tif (!transformed) {\n\t\t\t\treturn (preflightCheckResults[file] = null);\n\t\t\t}\n\n\t\t\tlet check = transformed.code;\n\n\t\t\tif (~check.indexOf('class ')) {\n\t\t\t\toptions.plugins = (options.plugins || []).concat(fallbackClassTransform);\n\t\t\t\tcheck = transform(inputCode, options).code;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!~check.indexOf('export default') &&\n\t\t\t\t!~check.indexOf('export default Foo') &&\n\t\t\t\t!~check.indexOf('export { Foo as default }')\n\t\t\t) {\n\t\t\t\tctx.error(MODULE_ERROR);\n\t\t\t}\n\n\t\t\tif (check.match(/\\/helpers\\/(esm\\/)?inherits/)) helpers = RUNTIME;\n\t\t\telse if (~check.indexOf('function _inherits')) helpers = INLINE;\n\t\t\telse if (~check.indexOf('babelHelpers')) helpers = EXTERNAL;\n\t\t\telse {\n\t\t\t\tctx.error(UNEXPECTED_ERROR);\n\t\t\t}\n\n\t\t\tpreflightCheckResults[file] = helpers;\n\t\t}\n\n\t\treturn preflightCheckResults[file];\n\t};\n}\n","import { HELPERS } from './constants.js';\nimport { addNamed } from '@babel/helper-module-imports';\n\nexport default function importHelperPlugin() {\n\treturn {\n\t\tpre(file) {\n\t\t\tconst cachedHelpers = {};\n\t\t\tfile.set('helperGenerator', name => {\n\t\t\t\tif (cachedHelpers[name]) {\n\t\t\t\t\treturn cachedHelpers[name];\n\t\t\t\t}\n\t\t\t\treturn (cachedHelpers[name] = addNamed(file.path, name, HELPERS));\n\t\t\t});\n\t\t},\n\t};\n}\n","let warned = {};\nexport function warnOnce(ctx, msg) {\n\tif (warned[msg]) return;\n\twarned[msg] = true;\n\tctx.warn(msg);\n}\n\nconst regExpCharactersRegExp = /[\\\\^$.*+?()[\\]{}|]/g;\nexport const escapeRegExpCharacters = str => str.replace(regExpCharactersRegExp, '\\\\$&');\n","import { buildExternalHelpers, DEFAULT_EXTENSIONS, loadPartialConfig, transform } from '@babel/core';\nimport { createFilter } from 'rollup-pluginutils';\nimport createPreflightCheck from './preflightCheck.js';\nimport helperPlugin from './helperPlugin.js';\nimport { escapeRegExpCharacters, warnOnce } from './utils.js';\nimport { RUNTIME, EXTERNAL, HELPERS } from './constants.js';\n\nconst unpackOptions = ({\n\textensions = DEFAULT_EXTENSIONS,\n\t// rollup uses sourcemap, babel uses sourceMaps\n\t// just normalize them here so people don't have to worry about it\n\tsourcemap = true,\n\tsourcemaps = true,\n\tsourceMap = true,\n\tsourceMaps = true,\n\t...rest\n} = {}) => ({\n\textensions,\n\tplugins: [],\n\tsourceMaps: sourcemap && sourcemaps && sourceMap && sourceMaps,\n\t...rest,\n\tcaller: {\n\t\tname: 'rollup-plugin-babel',\n\t\tsupportsStaticESM: true,\n\t\tsupportsDynamicImport: true,\n\t\t...rest.caller,\n\t},\n});\n\nexport default function babel(options) {\n\t// TODO: remove it later, just provide a helpful warning to people for now\n\ttry {\n\t\tloadPartialConfig({\n\t\t\tcaller: undefined,\n\t\t\tbabelrc: false,\n\t\t\tconfigFile: false,\n\t\t});\n\t} catch (err) {\n\t\tthrow new Error(\n\t\t\t'You should be using @babel/core@^7.0.0-rc.2. Please upgrade or pin rollup-plugin-babel to 4.0.0-beta.8',\n\t\t);\n\t}\n\n\tconst {\n\t\texclude,\n\t\textensions,\n\t\texternalHelpers,\n\t\texternalHelpersWhitelist,\n\t\tinclude,\n\t\truntimeHelpers,\n\t\t...babelOptions\n\t} = unpackOptions(options);\n\n\tconst extensionRegExp = new RegExp(`(${extensions.map(escapeRegExpCharacters).join('|')})$`);\n\tconst includeExcludeFilter = createFilter(include, exclude);\n\tconst filter = id => extensionRegExp.test(id) && includeExcludeFilter(id);\n\tconst preflightCheck = createPreflightCheck();\n\n\treturn {\n\t\tname: 'babel',\n\n\t\tresolveId(id) {\n\t\t\tif (id === HELPERS) return id;\n\t\t},\n\n\t\tload(id) {\n\t\t\tif (id !== HELPERS) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn buildExternalHelpers(externalHelpersWhitelist, 'module');\n\t\t},\n\n\t\ttransform(code, id) {\n\t\t\tif (!filter(id)) return null;\n\t\t\tif (id === HELPERS) return null;\n\n\t\t\tconst helpers = preflightCheck(this, babelOptions, id);\n\n\t\t\tif (!helpers) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (helpers === EXTERNAL && !externalHelpers) {\n\t\t\t\twarnOnce(\n\t\t\t\t\tthis,\n\t\t\t\t\t'Using \"external-helpers\" plugin with rollup-plugin-babel is deprecated, as it now automatically deduplicates your Babel helpers.',\n\t\t\t\t);\n\t\t\t} else if (helpers === RUNTIME && !runtimeHelpers) {\n\t\t\t\tthis.error(\n\t\t\t\t\t'Runtime helpers are not enabled. Either exclude the transform-runtime Babel plugin or pass the `runtimeHelpers: true` option. See https://github.com/rollup/rollup-plugin-babel#configuring-babel for more information',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst localOpts = {\n\t\t\t\tfilename: id,\n\t\t\t\t...babelOptions,\n\t\t\t\tplugins: helpers !== RUNTIME ? [...babelOptions.plugins, helperPlugin] : babelOptions.plugins,\n\t\t\t};\n\n\t\t\tconst transformed = transform(code, localOpts);\n\n\t\t\tif (!transformed) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcode: transformed.code,\n\t\t\t\tmap: transformed.map,\n\t\t\t};\n\t\t},\n\t};\n}\n"],"names":["const","let","helperPlugin"],"mappings":"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"}